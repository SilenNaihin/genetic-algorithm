{
  "project": "Frontend Refactoring - main.ts Decomposition + Modernization",
  "goal": "Break down main.ts (4113 lines) into smaller modules (<500 lines each), migrate styles to Tailwind, prepare for React",
  "approach": "Extract one component at a time with Tailwind conversion, verify after each step, then migrate to React",
  "phases": [
    {
      "id": 1,
      "name": "Cleanup - Remove incomplete extractions",
      "status": "completed",
      "description": "Deleted untracked WIP files, removed unused dependencies"
    },
    {
      "id": 2,
      "name": "Extract AppState types",
      "status": "completed",
      "description": "Moved type definitions to src/types/app.ts"
    },
    {
      "id": 3,
      "name": "Setup Tailwind CSS",
      "status": "completed",
      "description": "Installed Tailwind v4, created src/styles/main.css with design system tokens, moved CSS from index.html"
    },
    {
      "id": 4,
      "name": "Extract CreatureMeshFactory",
      "status": "completed",
      "description": "Extract createCreatureMesh and updateMuscleMesh to src/rendering/CreatureMeshFactory.ts"
    },
    {
      "id": 5,
      "name": "Extract TooltipManager",
      "status": "completed",
      "description": "Extract tooltip creation, show/hide logic to src/ui/TooltipManager.ts",
      "test_focus": "Hover over creature cards in grid view - tooltip should appear with ID, fitness, pellets, nodes/muscles, parent info"
    },
    {
      "id": 6,
      "name": "Extract PreviewRenderer",
      "status": "completed",
      "description": "Extract 3D preview animation to src/rendering/PreviewRenderer.ts",
      "test_focus": "Menu screen - animated creature preview should bounce/move"
    },
    {
      "id": 7,
      "name": "Extract ReplayRenderer",
      "status": "completed",
      "description": "Extract replay 3D rendering to src/rendering/ReplayRenderer.ts",
      "test_focus": "Click creature card to open replay modal - play/pause, speed controls, scrubbing"
    },
    {
      "id": 8,
      "name": "Extract CreatureCardRenderer",
      "status": "completed",
      "description": "Extract WebGL thumbnail rendering to src/ui/CreatureCardRenderer.ts",
      "test_focus": "Grid view - creature cards render correctly with thumbnails"
    },
    {
      "id": 9,
      "name": "Extract GenerationNavigator",
      "status": "completed",
      "description": "Extract navigation helpers to src/ui/GenerationNavigator.ts",
      "test_focus": "Generation nav arrows, jump to generation, viewing historical generations"
    },
    {
      "id": 10,
      "name": "Extract StatsRenderer",
      "status": "completed",
      "description": "Extract step indicator and settings HTML to src/ui/StatsRenderer.ts",
      "test_focus": "Stats panel updates, step indicators highlight correctly"
    },
    {
      "id": 11,
      "name": "Extract MenuBuilder",
      "status": "deferred",
      "description": "600+ line method with deep coupling - defer to React migration",
      "deferred_reason": "createMenuScreen is 600+ lines with HTML template + event handlers tightly coupled to config",
      "see_also": "react-migration.md"
    },
    {
      "id": 12,
      "name": "Extract SimulationController",
      "status": "deferred",
      "description": "~500 lines with deep DOM coupling for card animations - defer to React migration",
      "deferred_reason": "7 methods (startSimulation, executeNextStep, runMutateStep, etc.) with heavy card animation DOM manipulation",
      "see_also": "react-migration.md"
    },
    {
      "id": 13,
      "name": "Extract LoadRunsModal",
      "status": "deferred",
      "description": "~370 lines with loadRun() setting 15+ instance variables - defer to React migration",
      "deferred_reason": "loadRun() directly sets config, generation, population, simulationResults - better as React state dispatch",
      "see_also": "react-migration.md"
    },
    {
      "id": 14,
      "name": "Extract ControlPanel",
      "status": "deferred",
      "description": "Only ~35 lines actual (PRD overestimated) - not worth standalone extraction",
      "deferred_reason": "Too small to extract meaningfully, becomes trivial React component",
      "see_also": "react-migration.md"
    },
    {
      "id": 15,
      "name": "Final modular cleanup",
      "status": "deferred",
      "description": "Cannot reach <500 line target without React - deferring to post-migration cleanup",
      "deferred_reason": "main.ts still 3500+ lines; remaining code is tightly coupled to app state"
    },
    {
      "id": 16,
      "name": "Setup React + Next.js",
      "status": "completed",
      "description": "Installed Next.js 16 with Turbopack, created app/ directory with layout.tsx and page.tsx, vanilla app bootstrapped via dynamic import",
      "test_focus": "App loads without errors"
    },
    {
      "id": 17,
      "name": "Setup Zustand store + folder structure",
      "description": "Install Zustand, create app/stores/evolutionStore.ts with state shape, create folder structure (components/common, menu, grid, modals), create app/types/ui.ts",
      "test_focus": "npm run build passes, no runtime errors"
    },
    {
      "id": 18,
      "name": "Create services layer",
      "description": "Create src/services/SimulationService.ts and StorageService.ts as thin wrappers around domain logic for future backend migration",
      "test_focus": "npm run build passes, services export correctly"
    },
    {
      "id": 19,
      "name": "Common components + Three.js hooks",
      "description": "Create app/components/common/ (Button, Modal, ProgressBar), create app/hooks/useThreeRenderer.ts for Three.js lifecycle management",
      "test_focus": "Components render without errors"
    },
    {
      "id": 20,
      "name": "MenuScreen component",
      "description": "Create MenuScreen with PreviewCanvas, ParamSliders, config panels. Wire to Zustand store. Convert CSS to Tailwind.",
      "test_focus": "Menu renders, sliders update config, preview creature animates, Start button works"
    },
    {
      "id": 21,
      "name": "GridView shell + ControlPanel",
      "description": "Create GridView container, ControlPanel with Step/Auto/Graph/Reset buttons. Wire to Zustand actions.",
      "test_focus": "Grid view renders, buttons trigger actions (may not fully work yet)"
    },
    {
      "id": 22,
      "name": "CreatureCard + CreatureGrid",
      "description": "Create CreatureCard with canvas thumbnail (using CreatureCardRenderer), CreatureGrid to display 100 cards. Handle click for replay.",
      "test_focus": "Cards render with creature thumbnails, clicking opens replay"
    },
    {
      "id": 23,
      "name": "StatsPanel",
      "description": "Create StatsPanel with generation info, step indicator, settings display, generation navigation arrows.",
      "test_focus": "Stats display correctly, navigation arrows work, step indicator highlights"
    },
    {
      "id": 24,
      "name": "ReplayModal",
      "description": "Create ReplayModal with 3D replay canvas (using ReplayRenderer), play/pause, speed controls, timeline scrubbing.",
      "test_focus": "Replay plays correctly, controls work, modal closes properly"
    },
    {
      "id": 25,
      "name": "LoadRunsModal",
      "description": "Create LoadRunsModal to display saved runs, load/delete functionality. Wire to StorageService.",
      "test_focus": "Modal shows saved runs, can load a run, can delete a run"
    },
    {
      "id": 26,
      "name": "Wire simulation logic",
      "description": "Connect Zustand actions to SimulationService. Implement startSimulation, executeNextStep, autoRun in store actions.",
      "test_focus": "Full evolution cycle works: mutate -> simulate -> sort, auto-run works"
    },
    {
      "id": 27,
      "name": "Graph panels integration",
      "description": "Integrate existing GraphPanel and CreatureTypesPanel classes with React, or convert to React components.",
      "test_focus": "Fitness graph shows, creature types chart shows, toggle works"
    },
    {
      "id": 28,
      "name": "Remove vanilla code",
      "description": "Delete main.ts EvolutionApp class, remove unused vanilla code from src/ui/, update page.tsx to render React app directly",
      "test_focus": "App works entirely through React, no vanilla bootstrap"
    },
    {
      "id": 29,
      "name": "Final cleanup + visual parity check",
      "description": "Remove unused CSS, verify Tailwind visual parity, add error boundaries around Three.js, final testing",
      "test_focus": "Full app regression - every feature works, visuals match original"
    }
  ],
  "notes": [
    "Each phase should be committed separately",
    "User will manually test after each phase",
    "ALWAYS tell user what functionality to test (test_focus field)",
    "If any phase breaks functionality, revert and reassess",
    "Target: All files < 500 lines",
    "Tailwind: Convert CSS classes to utility classes as we extract",
    "React: Final migration after modularization is complete",
    "Deferred extractions tracked in react-migration.md"
  ]
}
