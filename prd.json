{
  "project": "Frontend Refactoring - main.ts Decomposition + Modernization",
  "goal": "Break down main.ts (4113 lines) into smaller modules (<500 lines each), migrate styles to Tailwind, prepare for React",
  "approach": "Extract one component at a time with Tailwind conversion, verify after each step, then migrate to React",
  "phases": [
    {
      "id": 1,
      "name": "Cleanup - Remove incomplete extractions",
      "status": "completed",
      "description": "Deleted untracked WIP files, removed unused dependencies"
    },
    {
      "id": 2,
      "name": "Extract AppState types",
      "status": "completed",
      "description": "Moved type definitions to src/types/app.ts"
    },
    {
      "id": 3,
      "name": "Setup Tailwind CSS",
      "status": "completed",
      "description": "Installed Tailwind v4, created src/styles/main.css with design system tokens, moved CSS from index.html"
    },
    {
      "id": 4,
      "name": "Extract CreatureMeshFactory",
      "status": "completed",
      "description": "Extract createCreatureMesh and updateMuscleMesh to src/rendering/CreatureMeshFactory.ts"
    },
    {
      "id": 5,
      "name": "Extract TooltipManager",
      "status": "completed",
      "description": "Extract tooltip creation, show/hide logic to src/ui/TooltipManager.ts",
      "test_focus": "Hover over creature cards in grid view - tooltip should appear with ID, fitness, pellets, nodes/muscles, parent info"
    },
    {
      "id": 6,
      "name": "Extract PreviewRenderer",
      "status": "completed",
      "description": "Extract 3D preview animation to src/rendering/PreviewRenderer.ts",
      "test_focus": "Menu screen - animated creature preview should bounce/move"
    },
    {
      "id": 7,
      "name": "Extract ReplayRenderer",
      "status": "completed",
      "description": "Extract replay 3D rendering to src/rendering/ReplayRenderer.ts",
      "test_focus": "Click creature card to open replay modal - play/pause, speed controls, scrubbing"
    },
    {
      "id": 8,
      "name": "Extract CreatureCardRenderer",
      "status": "completed",
      "description": "Extract WebGL thumbnail rendering to src/ui/CreatureCardRenderer.ts",
      "test_focus": "Grid view - creature cards render correctly with thumbnails"
    },
    {
      "id": 9,
      "name": "Extract GenerationNavigator",
      "status": "completed",
      "description": "Extract navigation helpers to src/ui/GenerationNavigator.ts",
      "test_focus": "Generation nav arrows, jump to generation, viewing historical generations"
    },
    {
      "id": 10,
      "name": "Extract StatsRenderer",
      "status": "completed",
      "description": "Extract step indicator and settings HTML to src/ui/StatsRenderer.ts",
      "test_focus": "Stats panel updates, step indicators highlight correctly"
    },
    {
      "id": 11,
      "name": "Extract MenuBuilder",
      "status": "deferred",
      "description": "600+ line method with deep coupling - defer to React migration",
      "deferred_reason": "createMenuScreen is 600+ lines with HTML template + event handlers tightly coupled to config",
      "see_also": "react-migration.md"
    },
    {
      "id": 12,
      "name": "Extract SimulationController",
      "status": "deferred",
      "description": "~500 lines with deep DOM coupling for card animations - defer to React migration",
      "deferred_reason": "7 methods (startSimulation, executeNextStep, runMutateStep, etc.) with heavy card animation DOM manipulation",
      "see_also": "react-migration.md"
    },
    {
      "id": 13,
      "name": "Extract LoadRunsModal",
      "status": "deferred",
      "description": "~370 lines with loadRun() setting 15+ instance variables - defer to React migration",
      "deferred_reason": "loadRun() directly sets config, generation, population, simulationResults - better as React state dispatch",
      "see_also": "react-migration.md"
    },
    {
      "id": 14,
      "name": "Extract ControlPanel",
      "status": "deferred",
      "description": "Only ~35 lines actual (PRD overestimated) - not worth standalone extraction",
      "deferred_reason": "Too small to extract meaningfully, becomes trivial React component",
      "see_also": "react-migration.md"
    },
    {
      "id": 15,
      "name": "Final modular cleanup",
      "status": "deferred",
      "description": "Cannot reach <500 line target without React - deferring to post-migration cleanup",
      "deferred_reason": "main.ts still 3500+ lines; remaining code is tightly coupled to app state"
    },
    {
      "id": 16,
      "name": "Setup React + Next.js",
      "description": "Install React, setup Vite for React, create App.tsx shell component",
      "test_focus": "App loads without errors"
    },
    {
      "id": 17,
      "name": "Convert modules to React components",
      "description": "Convert extracted modules to React functional components, integrate state management",
      "test_focus": "Each component as converted - same functionality as vanilla version",
      "subphases": [
        "MenuScreen component",
        "CreatureGrid component",
        "StatsPanel component",
        "ControlPanel component",
        "ReplayModal component",
        "LoadRunsModal component"
      ]
    },
    {
      "id": 18,
      "name": "State management + hooks",
      "description": "Extract app state to React context/hooks, wire up components",
      "test_focus": "State flows correctly between components, no stale state issues"
    },
    {
      "id": 19,
      "name": "Final React cleanup",
      "description": "Remove old vanilla JS code, final testing",
      "test_focus": "Full app regression test - every feature works"
    }
  ],
  "notes": [
    "Each phase should be committed separately",
    "User will manually test after each phase",
    "ALWAYS tell user what functionality to test (test_focus field)",
    "If any phase breaks functionality, revert and reassess",
    "Target: All files < 500 lines",
    "Tailwind: Convert CSS classes to utility classes as we extract",
    "React: Final migration after modularization is complete",
    "Deferred extractions tracked in react-migration.md"
  ]
}
