{
  "project": "Frontend Refactoring - main.ts Decomposition + Modernization",
  "goal": "Break down main.ts (4113 lines) into smaller modules (<500 lines each), migrate styles to Tailwind, prepare for React",
  "approach": "Extract one component at a time with Tailwind conversion, verify after each step, then migrate to React",
  "phases": [
    {
      "id": 1,
      "name": "Cleanup - Remove incomplete extractions",
      "status": "completed",
      "description": "Deleted untracked WIP files, removed unused dependencies"
    },
    {
      "id": 2,
      "name": "Extract AppState types",
      "status": "completed",
      "description": "Moved type definitions to src/types/app.ts"
    },
    {
      "id": 3,
      "name": "Setup Tailwind CSS",
      "status": "completed",
      "description": "Installed Tailwind v4, created src/styles/main.css with design system tokens, moved CSS from index.html"
    },
    {
      "id": 4,
      "name": "Extract CreatureMeshFactory",
      "status": "completed",
      "description": "Extract createCreatureMesh and updateMuscleMesh to src/rendering/CreatureMeshFactory.ts"
    },
    {
      "id": 5,
      "name": "Extract TooltipManager",
      "description": "Extract tooltip creation, show/hide logic to src/ui/TooltipManager.ts",
      "test_focus": "Hover over creature cards in grid view - tooltip should appear with ID, fitness, pellets, nodes/muscles, parent info",
      "tailwind": "Convert .creature-tooltip styles to Tailwind utilities",
      "estimated_lines": "~50 lines"
    },
    {
      "id": 6,
      "name": "Extract PreviewRenderer",
      "description": "Extract 3D preview animation (setupPreview, regeneratePreviewCreature, animatePreview) to src/rendering/PreviewRenderer.ts",
      "test_focus": "Menu screen - animated creature preview should bounce/move, regenerate button should create new creature",
      "tailwind": "Convert .menu-preview styles to Tailwind utilities",
      "estimated_lines": "~200 lines"
    },
    {
      "id": 7,
      "name": "Extract ReplayController",
      "description": "Extract replay modal and animation logic to src/ui/ReplayController.ts",
      "test_focus": "Click creature card to open replay modal - play/pause, speed controls, scrubbing, close button",
      "tailwind": "Convert modal styles to Tailwind utilities",
      "estimated_lines": "~400 lines"
    },
    {
      "id": 8,
      "name": "Extract CreatureCardRenderer",
      "description": "Extract creature card creation and 2D canvas rendering to src/ui/CreatureCardRenderer.ts",
      "test_focus": "Grid view - creature cards render correctly, show rank/fitness badges, elite/mutated/dead styling",
      "tailwind": "Convert .creature-card, .creature-grid styles to Tailwind utilities",
      "estimated_lines": "~350 lines"
    },
    {
      "id": 9,
      "name": "Extract GenerationNavigator",
      "description": "Extract generation navigation, load/save, fork logic to src/ui/GenerationNavigator.ts",
      "test_focus": "Generation nav arrows, jump to generation, viewing historical generations, fork from history",
      "tailwind": "Convert .gen-nav styles to Tailwind utilities",
      "estimated_lines": "~450 lines"
    },
    {
      "id": 10,
      "name": "Extract StatsRenderer",
      "description": "Extract getStatsHTML, updateStats, step indicators to src/ui/StatsRenderer.ts",
      "test_focus": "Stats panel updates during evolution, step indicators (mutate/simulate/sort) highlight correctly",
      "tailwind": "Convert .stats-panel, .step-indicator styles to Tailwind utilities",
      "estimated_lines": "~300 lines"
    },
    {
      "id": 11,
      "name": "Extract MenuBuilder",
      "description": "Extract createMenuScreen and slider setup to src/ui/MenuBuilder.ts",
      "test_focus": "Menu screen - all sliders work, values update, Start/Load buttons function",
      "tailwind": "Convert .menu-screen, .param-group styles to Tailwind utilities",
      "estimated_lines": "~500 lines"
    },
    {
      "id": 12,
      "name": "Extract SimulationController",
      "description": "Extract simulation/evolution logic (startSimulation, executeNextStep, autoRun) to src/simulation/SimulationController.ts",
      "test_focus": "Evolution cycle - mutate/simulate/sort steps execute correctly, auto-run works, progress bar updates",
      "tailwind": "Convert .progress-container styles to Tailwind utilities",
      "estimated_lines": "~400 lines"
    },
    {
      "id": 13,
      "name": "Extract LoadRunsModal",
      "description": "Extract load runs modal creation and logic to src/ui/LoadRunsModal.ts",
      "test_focus": "Load Runs button - modal opens, shows saved runs, can load/delete runs",
      "tailwind": "Convert .modal-overlay styles to Tailwind utilities",
      "estimated_lines": "~200 lines"
    },
    {
      "id": 14,
      "name": "Extract ControlPanel",
      "description": "Extract bottom control panel to src/ui/ControlPanel.ts",
      "test_focus": "Bottom control bar - all buttons work (Step, Auto, Menu, Save, Load, graphs, neural viz)",
      "tailwind": "Convert .control-panel, .btn styles to Tailwind utilities",
      "estimated_lines": "~150 lines"
    },
    {
      "id": 15,
      "name": "Final modular cleanup",
      "description": "Review main.ts, ensure it's under 500 lines, remove unused CSS from main.css",
      "test_focus": "Full app test - all features still work end-to-end"
    },
    {
      "id": 16,
      "name": "Setup React + Next.js",
      "description": "Install React, setup Vite for React, create App.tsx shell component",
      "test_focus": "App loads without errors"
    },
    {
      "id": 17,
      "name": "Convert modules to React components",
      "description": "Convert extracted modules to React functional components, integrate state management",
      "test_focus": "Each component as converted - same functionality as vanilla version",
      "subphases": [
        "MenuScreen component",
        "CreatureGrid component",
        "StatsPanel component",
        "ControlPanel component",
        "ReplayModal component",
        "LoadRunsModal component"
      ]
    },
    {
      "id": 18,
      "name": "State management + hooks",
      "description": "Extract app state to React context/hooks, wire up components",
      "test_focus": "State flows correctly between components, no stale state issues"
    },
    {
      "id": 19,
      "name": "Final React cleanup",
      "description": "Remove old vanilla JS code, final testing",
      "test_focus": "Full app regression test - every feature works"
    }
  ],
  "notes": [
    "Each phase should be committed separately",
    "User will manually test after each phase",
    "ALWAYS tell user what functionality to test (test_focus field)",
    "If any phase breaks functionality, revert and reassess",
    "Target: All files < 500 lines",
    "Tailwind: Convert CSS classes to utility classes as we extract",
    "React: Final migration after modularization is complete"
  ]
}
